function wait_for(t){function e(){n>0?($submit.html('<div style="width:55px;"><i class="loading mr10"></i>'+n+"</div>").attr("disabled",!0),n--,setTimeout(e,1e3)):($submit.html(o).attr("disabled",!1),n=15)}var n=t||15,o=$submit.html();e()}$.fn.FixedInput=function(t){var e=$(this);switch(e.attr("on-start")||e.on("click",".fixed-body",function(){e.FixedInput("hide")}).attr("on-start",!0),t){case"show":return e.addClass("show"),setTimeout(()=>{$(e.find("textarea,input")[0]).focus()},100);case"hide":return e.find("#cancel-comment-reply-link").click(),e.find("input,textarea").blur(),e.find(".dropup").removeClass("open"),e.removeClass("show")}},_win.bd.on("click","[fixed-input]",function(){var t=$(this),e=$(t.attr("fixed-input"));scrollTo("#comments",-50),e.FixedInput("show")}),$comments=$("#comments-title"),$cancel=$("#cancel-comment-reply-link"),$author=$("#comment-user-info"),$submit=$("#commentform #submit"),$com_ajax_url=_win.ajax_url,$com_list=$("#postcomments .commentlist"),_win.bd.on("click",".commentlist .pagenav a,.comment-orderby",function(){var t=$(this);$("#cancel-comment-reply-link").click();var e=!t.attr("no-replace");return post_ajax($(this),".commentlist",".commentlist",">.comment","",".pagenav","","",e)}),_win.bd.on("click",".comment-edit-link,.comment-reply-link",function(){var t=$(this),e=t.attr("data-commentid"),n=t.hasClass("comment-edit-link");return addComment.moveForm(t,"div-comment-"+e,e,"respond",t.attr("data-postid"),n),scrollTo($("#div-comment-"+e),-40),!1}),_win.bd.on("keydown","#comment",function(t){t.ctrlKey&&13==t.keyCode&&$submit.click()}),_win.bd.on("click",".comment-trash-link",function(){var t=$(this),e=t.attr("data-commentid"),n={action:"trash_comment",comment_id:e};1==confirm("确认要删除此评论吗？")&&zib_ajax(t,n,function(t){t.error||$("#comment-"+e).slideUp().delay(1e3,function(){$(this).remove()})},"正在处理请稍后...")}),_win.bd.on("click",".comment-approve-link",function(){var t=$(this),e=t.attr("data-commentid"),n={action:"approve_comment",comment_id:e},o=$("#div-comment-"+e).find(".reply-link");zib_ajax(t,n,function(n){if(!n.error){var m="hold"==n.status?"批准":"驳回",a="hold"==n.status?"approve":"unapprove",i="hold"==n.status?'<span class="badg c-red badg-sm">待审核</span>':"";"hold"==n.status?o.remove():o.length||t.parents(".dropdown").before('<span class="reply-link"><a class="comment-reply-link" data-commentid="'+e+'" href="javascript:;">回复</a></span>'),$("#div-comment-"+e).find(".badge-approve").html(i),t.removeClass("approve unapprove").addClass(a).find("text").html(m)}})}),_win.bd.on("click","#commentform #submit",function(){var t=$(this),e=t.parents("#commentform"),n=e.serializeObject();if($author.length&&$author.attr("require_name_email")){if(n.author.length<2||n.email.length<4)return notyf("请输入昵称和邮箱","warning"),$author.addClass("open").find('[name="author"]').focus(),!1;if(!is_mail(n.email))return notyf("邮箱格式错误","warning"),$author.addClass("open").find('[name="email"]').focus(),!1}return n.comment.length<4?(notyf("评论内容过少","warning"),$("#comment").focus(),!1):(n.action="submit_comment",zib_ajax(t,n,function(t){var e=t.html;if(!t.error&&e){if(n.edit_comment_ID)$cancel.click(),$("#comment-content-"+n.edit_comment_ID).html(e);else{e=e.replace(/class="comment/,'style="display:none;" class="comment ajax-comment');var o=$("#respond"),m=$("#postcomments .commentlist"),a=o.parent().parent(".comment");if(a.length){var i=a.find(">.children");i.length?i.prepend(e):a.append('<ul class="children">'+e+"</ul>")}else if(m.length){var c=$("#postcomments .commentlist>.comment-filter");c.length?c.after(e):m.prepend(e)}else o.after('<div id="postcomments"><ol class="commentlist list-unstyled">'+e+"</ol></div>");$cancel.click(),$("#postcomments .ajax-comment").slideDown(200).removeClass("ajax-comment"),$("#postcomments .comment-null").slideUp(200)}auto_fun(),wait_for(t.wait_time),$("#comment").val(""),$('[name="canvas_yz"]').val(""),$(".imagecaptcha").click(),$("#respond").FixedInput("hide")}}),!1)});var addComment={moveForm:function(t,e,n,o,m,a){var i,c=this,r=c.I(e),s=c.I(o),l=c.I("cancel-comment-reply-link"),d=c.I("comment_parent"),p=c.I("comment_post_ID"),u=$("#"+o+" .action-text");if($(".comment-footer").show(),a){var f=$submit.html();u.html("编辑此内容"),c.I("comment").value="",$("#comment_parent").attr("name","edit_comment_ID"),$submit.attr("disabled",!0).html('<i class="loading mr6"></i><span>加载中</span>'),$("#comment").attr("disabled",!0).val("正在获取内容，请稍后..."),$("#"+e).find(".comment-footer").hide();var h={action:"get_comment",comment_id:n};zib_ajax(t,h,function(t){t.error&&$cancel.click(),$submit.html(f).attr("disabled",!1),$("#comment").attr("disabled",!1).val(t.comment_content).focus()},"stop")}u.html(t.attr("data-replyto")),c.respondId=o,m=m||!1,c.I("wp-temp-form-div")||(i=document.createElement("div"),i.id="wp-temp-form-div",i.style.display="none",s.parentNode.insertBefore(i,s)),r?r.parentNode.insertBefore(s,r.nextSibling):(temp=c.I("wp-temp-form-div"),c.I("comment_parent").value="0",temp.parentNode.insertBefore(s,temp),temp.parentNode.removeChild(temp)),p&&m&&(p.value=m),d.value=n,l.style.display="",l.onclick=function(){var t=addComment,e=t.I("wp-temp-form-div"),n=t.I(t.respondId);return $("#comment_parent").attr("name","comment_parent"),t.I("comment_parent").value="0",$(".comment-footer").show(),$("#comment").val("").trigger("input"),setTimeout(function(){$("#"+o).removeClass("show")},10),u.html(""),e&&n&&(e.parentNode.insertBefore(n,e),e.parentNode.removeChild(e)),this.style.display="none",this.onclick=null,!1};try{setTimeout(function(){$("#"+o).FixedInput("show")},10)}catch(t){}return!1},I:function(t){return document.getElementById(t)}};