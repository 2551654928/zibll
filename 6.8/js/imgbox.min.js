"use strict";window.Miniimgbox=function(i){function e(){var i=document.documentElement;i.requestFullscreen?i.requestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullScreen&&i.webkitRequestFullScreen(),$(".imgbox-an .toggle-full .fa").removeClass("fa-expand").addClass("fa-compress"),$(".imgbox.show").addClass("full-screen")}function a(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),$(".imgbox-an .toggle-full .fa").removeClass("fa-compress").addClass("fa-expand"),$(".imgbox.show").removeClass("full-screen")}function t(e){var a=e.parents(".imgbox"),t=a.attr("id");return i.imgbox[t][0]||i.imgbox[t]}function o(i,e,a,t){i=i&&" "+i;var o=a&&' id="'+a+'"',s="";s+=x.down?w.down:"",t&&(s+=x.play?w.play:"",s+=x.show_thumbs?w.thumbs:""),s+=x.zoom?w.zoom:"",s+=x.full?w.full:"",s+=w.close;var n='<div class="imgbox-an">'+s+"</div>",r='<div class="imgbox'+i+'"'+o+">"+b+n+e+"</div>";p.append(r),l(a),auto_fun()}function s(i){return i.replace(/(.*\/)(.*)(-\d+x\d+\.)(.*)/g,"$1$2.$4").replace(/\??x-oss-process(.*)/,"")}function n(i,e){$("body").addClass("imgbox-show"),h(i,e),$(i).addClass("show").removeClass("hide")}function r(){$("body").removeClass("imgbox-show");var e=$(".imgbox.show");e.addClass("hideing").removeClass("show"),a(),setTimeout(function(){e.removeClass("hideing").addClass("hide").attr("style",""),$(".toggle-palay.is-play").removeClass("is-play"),$.each(i.imgbox,function(i,e){try{e=e[0]||e,e.zoom.out()}catch(i){}}),$(".swiper-close").css({opacity:"",transform:""})},400)}function l(i){$("#"+i).on("touchmove pointermove MSPointerMove",function(i){i.preventDefault?i.preventDefault():i.returnValue=!1}),$("#"+i).minitouch({direction:"bottom",selector:".swiper-close",depreciation:100,onStart:!1,stop:function(i,e,a,t){var o=e.find("img").css("transform").replace(/[^0-9\-,]/g,"").split(",")[0];return o&&o>1},onIng:function(i,e,a,t){var o=(200-t)/100;o=o<1&&o,e.css("opacity",o)},inEnd:function(i,e,a,t){t<=50&&e.css({opacity:""})},onEnd:function(i,e,a,t){r(),e.css({transform:"translateY("+(t+200)+"px)"})}})}function c(i){var e=i.attr("src"),a=i.attr("data-src");if(!e&&!a)return"";var t=i.attr("data-full-url")||s(a||e),o=e==t?'<img src="'+t+'" class="lazyloaded">':'<img src="'+e+'" data-src="'+t+'"  class="lazyload"><div class="swiper-lazy-preloader"></div>',n='<div class="swiper-slide"><div class="swiper-close"><div class="swiper-zoom-container"><div class="absolute img-close"></div>'+o+"</div></div></div>";return n}function d(i){var e=i.attr("data-src")||i.attr("src");if(!e)return"";var a='<img data-src="'+e+'"  class="lazyload fit-cover">',t='<div class="swiper-slide">'+a+"</div>";return t}function u(e,a,t){tbquire(["swiper"],function(){var o="."+e,s=~~(($(i).width()+800)/310),n={init:!1};n.speed=100*s,n.zoom={maxRatio:$(i).width()<768?3:2},a&&(n.autoplay={disableOnInteraction:!1},n.grabCursor=!0,n.navigation={nextEl:o+" .swiper-button-next",prevEl:o+" .swiper-button-prev"},n.keyboard={enabled:!0,onlyInViewport:!1},n.on={slideChange:function(){$(o+" .counter-con").html('<badge class="b-black counter">'+(this.realIndex+1)+"/"+this.slides.length+"</badge>")}}),t&&(n.thumbs={swiper:i.imgbox[e+"_thumbs"],autoScrollOffset:~~(s/1.6)}),i.imgbox[e]=new Swiper(o,n)})}function m(e){tbquire(["swiper"],function(){var a=".swiper-thumbsbox."+e,t={init:!1,watchSlidesVisibility:!0};t.navigation={nextEl:a+" .swiper-button-next",prevEl:a+" .swiper-button-prev"},t.slidesPerView="auto",t.freeMode=!0,t.freeModeSticky=!0,i.imgbox[e+"_thumbs"]=new Swiper(a,t)})}function g(i){var e=i.attr("data-src")||i.attr("src");if(!e)return!1;e=s(e);var a=i.parent("a");if(!a.length)return!1;var t=a.attr("box-img")||a.attr("href");return t=s(t),t&&(-1==t.indexOf(e)||-1==e.indexOf(t))}$("link#swiper").length||$("head").append('<link type="text/css" id="swiper" rel="stylesheet" href="'+_win.uri+"/css/swiper.min.css?ver="+_win.ver+'">');var p=_win.bd,b='<div class="modal-backdrop imgbox-bg"></div>',v="imgbox-id",f="imgbox-index";i.imgbox={};var x={show_thumbs:_win.imgbox_thumbs||!1,down:_win.imgbox_down||!1,play:_win.imgbox_play||!1,zoom:_win.imgbox_zoom||!1,full:_win.imgbox_full||!1},w={thumbs:'<a href="javascript:;" class="toggle-thumbs toggle-radius mr6" title="查看更多图片"><i class="fa fa-th-large"></i></a>',close:'<a href="javascript:;" class="icon-close toggle-radius" title="关闭"><i data-svg="close" data-class="ic-close icon em12" data-viewbox="0 0 1024 1024"></i></a>',down:'<a href="javascript:;" download class="img-down toggle-radius mr6" title="下载图片"><i class="fa fa-download"></i></a>',play:'<a href="javascript:;" class="toggle-palay toggle-radius mr6" title="播放图片"><i class="fa fa-play"></i></a>',zoom:'<a href="javascript:;" class="toggle-zoom toggle-radius mr6" title="切换图片缩放"><i class="fa fa-search"></i></a>',full:'<a href="javascript:;" class="hide-sm toggle-full toggle-radius mr6" title="切换全屏"><i class="fa fa-expand"></i></a>'};p.on("click",".img-close,.imgbox-bg,.imgbox-an .icon-close",function(){r()}),p.on("click",".imgbox-an .toggle-thumbs,.hide-but",function(){$(this).parents(".group-box").toggleClass("show-thumb")}),p.on("click",".imgbox-an .img-down",function(){var i=$(this),e=i.parents(".imgbox"),a=e.find(".swiper-slide-active img"),t=a.attr("data-src")||a.attr("src"),o=t.substring(t.lastIndexOf("/")+1)||t;i.attr("href",t).attr("download",o)}),p.on("click",".imgbox-an .toggle-palay",function(){var i=$(this),e=t(i);i.hasClass("is-play")?e.autoplay.stop():e.autoplay.start(),i.toggleClass("is-play")}),p.on("click",".imgbox-an .toggle-zoom",function(){var i=$(this),e=t(i);e.zoom.toggle(),i.toggleClass("is-zoom")}),p.on("click",".imgbox-an .toggle-full",function(){document.fullscreenElement?a():e()});var h=function(i,e){var a=e.offset(),t=a.top,o=a.left,s=$(document).scrollTop(),n=e.height(),r=e.width(),l=t-s+n/2,c=o+r/2;$(i).attr("style","--imgbox-origin-top:"+l+"px;--imgbox-origin-left:"+c+"px;")},y=function(e){var a=$(e);if(a.length){var t=x.show_thumbs,s="",r="",l="swiper-imgbox-"+parseInt((Math.random()+1)*Math.pow(10,4));a.each(function(i){var e=$(this);g(e)||(e.attr({"imgbox-id":l,"imgbox-index":i}),s+=c(e),t&&(r+=d(e)))});var b='<div class="swiper-wrapper">'+s+"</div>",w='<div class="swiper-imgbox '+l+'">'+b+'<div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-left counter-con"></div></div>',h='<div class="swiper-wrapper">'+r+"</div>",y='<div class="swiper-thumbsbox '+l+'">'+h+'<div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-center right-top"><i class="hide-but fa fa-angle-down em12"></i></div></div>';t&&(w+=y);var _="group-box"+(t?" thumbs-box":"");o(_,w,l,!0),t&&m(l),u(l,!0,t),p.OnlyOn("click",e,"imgbox_group_open",function(){var e=$(this).attr(v);if(e){var a=$(this).attr(f),t=i.imgbox[e];t=t[0]||t;var o=i.imgbox[e+"_thumbs"];return n("#"+e,$(this)),o&&o.init(),t.init(),t.slideToLoop(a,10),t.autoplay.stop(),!1}})}},_=function(e){if($(e).length){var a="swiper-imgbox-alone",t="#"+a;if(!$(t).length){var r='<div class="swiper-slide"><div class="swiper-close"><div class="swiper-zoom-container alone-box-container"><div class="absolute img-close"></div><img src=""><div class="swiper-lazy-preloader"></div></div></div></div>',l='<div class="swiper-wrapper">'+r+"</div>",c='<div class="swiper-imgbox '+a+'">'+l+"</div>";o("alone-box",c,a),u(a)}var d=$(t);p.OnlyOn("click",e,"imgbox_alone_open",function(){var e=$(this);if(!e.find("img").attr(v)&&!g(e)){var o=e.attr("box-img")||e.attr("href"),r=o||e.attr("src"),l=o?s(o):e.attr("data-full-url")||s(e.attr("data-src")||r),c=r==l?'<img src="'+l+'" class="lazyloaded">':'<img src="'+r+'" data-src="'+l+'" class="lazyload">',u=d.find(".alone-box-container>img");return u.attr("src")!=l&&u.prop("outerHTML",c),i.imgbox[a].init(),i.imgbox[a].update(),n(t,e),!1}})}};return{group:y,alone:_}}(window),"group"==_win.imgbox_type?(Miniimgbox.group(".wp-posts-content img:not(.no-imgbox,.avatar,.img-icon,.avatar-badge)"),Miniimgbox.group('[data-imgbox="payimg"] img')):Miniimgbox.alone(".wp-posts-content img:not(.no-imgbox,.avatar,.img-icon,.avatar-badge)"),Miniimgbox.alone(".comment-content .box-img,.alone-imgbox-img,a[data-imgbox]");