const poster=function(){function t(t){const r=document.querySelector(t.selector),c=i("div","id","wrapper"),h=i("canvas","id","canvas","block"),g=i("canvas","id","day"),f=i("canvas","id","date"),p=i("canvas","id","title"),u=i("canvas","id","content"),m=i("canvas","id","tags"),b=i("canvas","id","logo"),w=i("canvas","id","description");n(c,h,g,f,p,u,b,m,w),r.appendChild(c);const y=new Date;$weekarray=["日","一","二","三","四","五","六"];const v={font:"35px Arial",color:"rgba(255, 255, 255, 1)",position:"left"};a(g,v,"周"+$weekarray[y.getDay()]);const x={font:"28px Arial",color:"rgba(255, 255, 255, 1)",position:"left"};a(f,x,y.getMonth()+1+" / "+y.getDate());const S={font:"bold 35px Arial",lineHeight:1.5,color:"rgba(66, 66, 66, 1)",length:2,position:"left"};S.font=t.titleStyle&&t.titleStyle.font||S.font,S.color=t.titleStyle&&t.titleStyle.color||S.color,S.position=t.titleStyle&&t.titleStyle.position||S.position,l(p,S,t.title);const k={font:"25px Arial",lineHeight:1.5,position:"left",color:"rgba(88, 88, 88, 1)"};k.font=t.contentStyle&&t.contentStyle.font||k.font,k.color=t.contentStyle&&t.contentStyle.color||k.color,k.lineHeight=t.contentStyle&&t.contentStyle.lineHeight||k.lineHeight,k.position=t.contentStyle&&t.contentStyle.position||k.position,l(u,k,t.content);const R={font:"24px Roboto Slab",position:"left",color:"#fc4e1f"};R.color=t.tagsStyle&&t.tagsStyle.color||R.color,l(m,R,t.tags);const I={font:"22px Arial",color:"#b4b4b4",lineHeight:1.2,position:"center"};l(w,I,t.description);const A=new Image;A.crossOrigin="Anonymous";const _=new Image;var H=0;_.crossOrigin="Anonymous",_.src=t.logo,_.onerror=function(e){H++,H<3&&(_.src=t.logo)};const T=new Image;T.src=t.qrcode;var C=0;const j=function(){0==C&&(t.banner?A.src=t.banner:C=1),1==C&&(t.banner_default?A.src=t.banner_default:C=2),2==C&&(A.src=t.banner_spare),q()},q=function(){h.width=s,h.height=d,A.onload=function(){const i=h.getContext("2d");i.fillStyle="rgba(255, 255, 255, 1)",i.fillRect(0,0,h.width,h.height),imgRect=o(h.width,h.height/2,A.width,A.height),i.drawImage(A,imgRect.sx,imgRect.sy,imgRect.sWidth,imgRect.sHeight,0,0,h.width,h.height/2),i.drawImage(g,0,35),i.drawImage(f,0,85),i.strokeStyle="#00a1ff",i.lineWidth=7,i.beginPath(),i.lineCap="round",i.moveTo(40,h.height/2+38),i.lineTo(40,h.height/2+74),i.stroke(),i.drawImage(p,20,h.height/2+40),i.drawImage(m,0,h.height/2+160),i.drawImage(u,0,h.height/2+220),i.strokeStyle="rgba(122, 122, 122, 0.3)",i.lineWidth=2,i.rect(30,h.height-230,h.width-60,200),i.stroke(),logoRect=e(80,h.height-190,300,100,_.width,_.height),i.drawImage(_,logoRect.dx,logoRect.dy,logoRect.dWidth,logoRect.dHeight),i.drawImage(T,h.width-200,h.height-200,120,120),i.drawImage(w,0,h.height-60);const n=new Image;n.crossOrigin="Anonymous",n.src=h.toDataURL("image/png");const a=t.radio||.7;n.width=s*a,n.height=d*a,n.className="loaded-img",i.clearRect(0,0,h.width,h.height),h.style.display="none",r.querySelector(".loaded-img")?r.querySelector(".loaded-img").src=n.src:r.appendChild(n),r.removeChild(c),r.classList.add("loaded"),$.isFunction(t.callback)&&t.callback(r)},A.onerror=function(e){if(C++,C>=3)return $.isFunction(t.onerror)&&t.onerror(r);j()}};j()}function e(t,e,o,i,n,a){var l=t,r=e,s=o,d=i;return n>a||n==a&&o<i?(d=a*s/n,r=e+(i-d)/2):(n<a||n==a&&o>i)&&(s=n*d/a,l=t+(o-s)/2),{dx:l,dy:r,dWidth:s,dHeight:d}}function o(t,e,o,i){var n=0,a=0,l=o,r=i;return o>i||o==i&&t<e?(l=t*r/e,n=(o-l)/2):(o<i||o==i&&t>e)&&(r=e*l/t,a=(i-r)/2),{sx:n,sy:a,sWidth:l,sHeight:r}}function i(t,e,o,i="none"){const n=document.createElement(t);return n.setAttribute(e,o),n.style.display=i,n.width=s,n}function n(t,...e){e.forEach(e=>{t.appendChild(e)})}function a(t,e,o){const i=t.getContext("2d");t.height=parseInt(e.font.match(/\d+/),10)+20,i.font=e.font,i.fillStyle=e.color,i.textBaseline="top";let n=0,a=0,l=!1;for(let e=0;e<o.length;e++)if(n+=i.measureText(o[e]).width,n>t.width-60){l=!0,a=e;break}let s=30;l&&(o=o.substring(0,a),s=t.width/2-n/2),r&&(i.strokeStyle="#6fda92",i.strokeRect(0,0,t.width,t.height)),"center"===e.position?(i.textAlign="center",i.fillText(o,t.width/2,2)):"left"===e.position?i.fillText(o,s,2):(i.textAlign="right",i.fillText(o,t.width-s,2))}function l(t,e,o){const i=t.getContext("2d"),n=parseInt(e.font.match(/\d+/),10);r&&(i.strokeStyle="#6fda92",i.strokeRect(0,0,t.width,t.height)),i.font=e.font,i.fillStyle=e.color,i.textBaseline="top",i.textAlign="center";let a=0;"center"===e.position?a=t.width/2:"left"===e.position?(i.textAlign="left",a=40):(i.textAlign="right",a=t.width-40);let l=0,s=0,d=2;for(let r=0;r<o.length;r++)l+=i.measureText(o[r]).width,l>t.width-120&&(i.fillText(o.substring(s,r),a,d),d+=n*e.lineHeight,l=0,s=r),r===o.length-1&&i.fillText(o.substring(s,r+1),a,d)}const r=0,s=768,d=1168;return{init:t}}();$("body").on("click","[poster-share]",function(){function t(t){if(null!=t){l.find(".poster-download").attr("href",l.find("img").attr("src")).attr("download","poster_"+o+".png").removeClass("hide");var e=l.find(".poster-imgbox").outerHeight();l.find(".loading-mask").fadeOut(200),l.find(".modal-content").css({height:e,transition:".2s"}),setTimeout(function(){l.find(".modal-content").css({height:"",overflow:"",transition:""})},200)}}var e=$(this),o=e.attr("poster-share"),i="modal_poster_"+o,n="#"+i,a='<div class="modal fade flex jc" id="'+i+'" tabindex="-1" role="dialog" aria-hidden="false">    <div class="modal-dialog poster-share hover-show" role="document">    <div class="modal-content" style="height:220px;overflow:hidden">    <div class="poster-imgbox hover-show">    </div>    <div class="flex jc loading-mask absolute main-bg radius8"><div class="loading zts fa-2x"></div><div class="muted-2-color box-body">正在生成图片，请稍候...</div>    </div>    </div>    <div class="padding-6 abs-center hover-show-con text-center" style="top:auto;"><a type="button" href="javascript:;" class="but toggle-radius jb-blue poster-download hide"><i class="fa fa-download" aria-hidden="true"></i></a><button data-dismiss="modal" class="but toggle-radius jb-yellow ml10"><svg aria-hidden="true" class="icon em12"><use xlink:href="#icon-close"></use></svg></button></div>    </div>    </div>';$(".modal:not("+n+")").modal("hide");var l=$(n);if(l.length)return l.modal("show"),!1;$("body").append(a),l=$(n),l.modal("show");var r={action:"poster_share_data",id:o};zib_ajax(e,r,function(e){poster.init({banner:e.banner,banner_default:e.banner_default,banner_spare:e.banner_spare,selector:n+" .poster-imgbox",title:e.title,content:e.content,logo:e.logo,tags:e.tags,description:e.description,qrcode:e.qrcode,onerror:function(t){notyf("海报加载失败","danger")},callback:t})},"stop")});