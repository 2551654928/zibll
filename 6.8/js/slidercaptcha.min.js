function SliderCaptchaModal(t,e){function i(t){var e=n(11,40),i=n(11,40);return e+""+o(e)+t+o(i)+i}function n(t,e){return Math.round(Math.random()*(t-e)+e)}function o(t){for(var e="",i=0;i<t;i++)e+=String.fromCharCode(Math.floor(26*Math.random())+"a".charCodeAt(0));return e}function s(){$("#"+r).removeClass("in"),setTimeout(function(){$("#"+r).hide()},300)}function a(){$("#"+r).show(),setTimeout(function(){$("#"+r).addClass("in"),$("#"+r+" .slidercaptcha").sliderCaptcha({onSuccess:function(t){var e=window.captcha.token,o=window.captcha.rand_str;delete window.captcha.rand_str,delete window.captcha.token;var a=n(1,9),r=n(15,25),c=~~e.substring(0,2),l=~~e.substring(e.length-2,e.length);e.substring(c+2,e.length-l-2);captcha.ticket=i(t.distance),captcha.randstr=a+""+o.substring(a,r)+r,captcha.spliced=t.spliced,captcha.trail=t.trail,setTimeout(function(){return s(),captcha._this.click(),!1},200)},setSrc:function(){return _win.uri+"/img/captcha/"+Math.round(20*Math.random())+".jpg"},getX:function(t,e){return $_x=n(t,e),window.captcha.ticket=0,window.captcha.randstr=0,window.captcha.spliced=0,$.ajax({url:_win.uri+"/action/captcha.php",data:{type:"slider",randstr:i($_x)}}).done(function(t){window.captcha.token=t.token,window.captcha.rand_str=t.rand_str,window.captcha.check=t.check}),$_x}})},30)}var r="SliderCaptcha";if(captcha._this=e,!$("#"+r).length){var c='<div id="'+r+'" class="modal flex jc fade" tabindex="-1" role="dialog" aria-hidden="false" style="display: none;user-select: none;z-index: 100000000;background:rgba(0,0,0,.5);"><div class="modal-mini modal-dialog" style="width: 340px;">    <div class="modal-content"><div class="modal-body"><div class="modal-colorful-header colorful-bg c-yellow" style="height: 100px;"><button class="close" data-dismiss="modal"><svg class="ic-close" aria-hidden="true"><use xlink:href="#icon-close"></use></svg></button><div class="colorful-make"></div><div class="text-center"><div class="em2x"><i class="fa fa-shield"></i></div><div class="mt6 em12">滑动以完成验证</div></div></div><div style="padding: 10px 0;margin-top: 100px;"><div class="slidercaptcha"></div></div></div></div></div></div>';$("body").append(c),$("#"+r+' [data-dismiss="modal"]').on("click",s)}"show"===t&&a(),"hide"===t&&s()}(function(t){"use strict";function e(e){return this.each(function(){var n=t(this),o=n.data("lgb.SliderCaptcha"),s="object"==typeof e&&e;o&&!/reset/.test(e)&&t(o.refreshIcon).click(),o||n.data("lgb.SliderCaptcha",o=new i(this,s)),"string"==typeof e&&o[e]()})}var i=function(e,n){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,n),this.$element.css({position:"relative",width:this.options.width+"px",margin:"0 auto"}),this.init()};i.DEFAULTS={width:280,height:170,PI:Math.PI,sliderL:42,sliderR:9,offset:8,loadingText:'<i class="loading mr6"></i>加载中...',failedText:"请再试一次",barText:"向右滑动填充拼图",repeatIcon:"fa fa-refresh",maxLoadCount:3,onFail:function(){},onSuccess:function(){},setSrc:function(){return""},getX:null},t.fn.sliderCaptcha=e,t.fn.sliderCaptcha.Constructor=i;var n=i.prototype;n.init=function(){this.initDOM(),this.initImg(),this.bindEvents()},n.initDOM=function(){var e=function(t,e){var i=document.createElement(t);return i.className=e,i},i=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i},n=i(this.options.width-2,this.options.height),o=n.cloneNode(!0),s=e("div","sliderContainer"),a=e("botton","refreshIcon "+this.options.repeatIcon),r=e("div","sliderMask"),c=e("div","captcha-slider"),l=e("i","fa fa-chevron-right sliderIcon"),d=e("span","sliderText");n.className="captcha-body-bg placeholder",o.className="captcha-body-bar",d.innerHTML=this.options.barText;var h=this.$element;h.html(t(n)),h.append(t(a)),h.append(t(o)),c.appendChild(l),s.appendChild(r),s.appendChild(c),s.appendChild(d),h.append(t(s));var p={canvas:n,block:o,sliderContainer:t(s),refreshIcon:a,slider:c,sliderMask:r,sliderIcon:l,text:t(d),canvasCtx:n.getContext("2d"),blockCtx:o.getContext("2d")};t.isFunction(Object.assign)?Object.assign(this,p):t.extend(this,p)},n.initImg=function(){var e=this,i=window.navigator.userAgent.indexOf("Trident")>-1,n=this.options.sliderL+2*this.options.sliderR+3,o=function(t,n){var o=e.options.sliderL,s=e.options.sliderR,a=e.options.PI,r=e.x,c=e.y;t.beginPath(),t.moveTo(r,c),t.arc(r+o/2,c-s+2,s,.72*a,2.26*a),t.lineTo(r+o,c),t.arc(r+o+s-2,c+o/2,s,1.21*a,2.78*a),t.lineTo(r+o,c+o),t.lineTo(r,c+o),t.arc(r+s-2,c+o/2,s+.4,2.76*a,1.24*a,!0),t.lineTo(r,c),t.lineWidth=2,t.fillStyle="rgba(100, 100, 100, 0.7)",t.strokeStyle="rgba(255, 255, 255, 0.5)",t.stroke(),t[n](),t.globalCompositeOperation=i?"xor":"destination-over"},s=function(t,e){return Math.round(Math.random()*(e-t)+t)},a=function(i,n){return t.isFunction(e.options.getX)?e.options.getX(i,n):s(i,n)},r=new Image;r.crossOrigin="Anonymous";var c=0;r.onload=function(){e.x=a(n+10,e.options.width-(n+10)),e.y=s(10+2*e.options.sliderR,e.options.height-(n+10)),o(e.canvasCtx,"fill"),o(e.blockCtx,"clip"),e.canvasCtx.drawImage(r,0,0,e.options.width-2,e.options.height),e.blockCtx.drawImage(r,0,0,e.options.width-2,e.options.height);var t=e.y-2*e.options.sliderR-1,i=e.blockCtx.getImageData(e.x-3,t,n,n);e.block.width=n,e.blockCtx.putImageData(i,0,t+1),e.text.text(e.text.attr("data-text"))},r.onerror=function(t){if(c++,c>=e.options.maxLoadCount)return e.text.text("加载失败").addClass("text-danger c-red"),void e.canvas.removeClass("placeholder");r.localImages()},r.setSrc=function(){if(c=0,e.text.removeClass("text-danger"),t.isFunction(e.options.setSrc)){var i=e.options.setSrc();i?r.src=e.options.setSrc():r.localImages()}},r.localImages=function(){e.text.removeClass("text-danger");var t="https://picsum.photos/"+e.options.width+"/"+e.options.height+"/?image="+Math.round(20*Math.random());if(i){var n=new XMLHttpRequest;n.onloadend=function(t){var e=new FileReader;e.readAsDataURL(t.target.response),e.onloadend=function(t){r.src=t.target.result}},n.open("GET",t),n.responseType="blob",n.send()}else r.src=t},r.setSrc(),this.text.attr("data-text",this.options.barText),this.text.html(this.options.loadingText),this.img=r},n.clean=function(){this.canvasCtx.clearRect(0,0,this.options.width,this.options.height),this.blockCtx.clearRect(0,0,this.options.width,this.options.height),this.block.width=this.options.width},n.bindEvents=function(){var e=this;this.$element.on("selectstart",function(){return!1}),t(this.refreshIcon).on("click",function(){e.text.text(e.options.barText),e.reset(),t.isFunction(e.options.onRefresh)&&e.options.onRefresh.call(e.$element)});var i,n,o,s,a=[],r=!1;this.$element.on("touchstart pointerdown MSPointerDown",".captcha-slider",function(t){e.text.hasClass("text-danger")||(i=t.originalEvent.pageX||t.originalEvent.touches[0].pageX,n=t.originalEvent.pageY||t.originalEvent.touches[0].pageY,r=!0)}).on("touchmove pointermove MSPointerMove",function(t){if(r){var c=t.originalEvent.pageX||t.originalEvent.touches[0].pageX,l=t.originalEvent.pageY||t.originalEvent.touches[0].pageY;if(o=c-i,s=l-n,o>=0&&o+40<=e.options.width){t.preventDefault?t.preventDefault():t.returnValue=!1,e.slider.style.left=o-1+"px";var d=(e.options.width-40-20)/(e.options.width-40)*o;e.block.style.left=d+"px",e.sliderContainer.addClass("sliderContainer_active"),e.sliderMask.style.width=o+4+"px",a.push(Math.round(s))}}}).on("touchend touchcancel pointerup MSPointerUp",function(i){if(r&&o>=0){e.sliderContainer.removeClass("sliderContainer_active"),e.trail=a;var n=e.verify();n.spliced&&n.verified?(e.sliderContainer.addClass("sliderContainer_success"),setTimeout(function(){e.slider.style.left=0,e.block.style.left=0,e.sliderMask.style.width=0,e.sliderContainer.removeClass("sliderContainer_fail sliderContainer_success")},500),t.isFunction(e.options.onSuccess)&&e.options.onSuccess.call(e.$element,n)):(e.sliderContainer.addClass("sliderContainer_fail"),t.isFunction(e.options.onFail)&&e.options.onFail.call(e.$element),setTimeout(function(){e.text.text(e.options.failedText),e.reset()},500))}o=0,s=0,r=!1})},n.verify=function(){var t=this.trail,e=parseInt(this.block.style.left),i=!1,n=function(t,e){return t+e},o=function(t){return t*t},s=t.reduce(n)/t.length,a=t.map(function(t){return t-s}),r=Math.sqrt(a.map(o).reduce(n)/t.length);return i=0!==r,{spliced:Math.abs(e-this.x)<this.options.offset,trail:t,verified:i,distance:e}},n.reset=function(){this.sliderContainer.removeClass("sliderContainer_fail sliderContainer_success"),this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.text.attr("data-text",this.text.text()),this.text.html(this.options.loadingText),this.img.setSrc()}})(jQuery);