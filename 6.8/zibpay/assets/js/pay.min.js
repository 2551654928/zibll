function GetRequest(a){var e=window.parent.location.search||_win.url_request||"";if(-1!=e.indexOf("?")){var i=e.substr(1);i.indexOf(!0)&&(i=i.substr(0)),strs=i.split("&");for(var t=0;t<strs.length;t++)if(-1!=strs[t].indexOf(a))return strs[t].split("=")[1]}return null}function delQueStr(a,e){var i="";if(e=e||window.location.href,-1==e.indexOf("?"))return e;i=e.substr(e.indexOf("?")+1);var t="",n="";if(-1!=i.indexOf("&")){for(var d in t=i.split("&"),t)t[d].split("=")[0]!=a&&(n=n+t[d].split("=")[0]+"="+t[d].split("=")[1]+"&");return e.substr(0,e.indexOf("?"))+"?"+n.substr(0,n.length-1)}return t=i.split("="),t[0]==a?e.substr(0,e.indexOf("?")):e}(function(a){function e(){var e='<div class="modal fade flex jc" style="display:none;" id="'+h+'" tabindex="-1" role="dialog" aria-hidden="false">        <div class="modal-dialog" role="document">            <div class="pay-payment alipay">                <div class="modal-body modal-pay-body">                    <div class="row-5 hide-sm">                        <img class="lazyload pay-sys t-wechat" alt="alipay" src="" data-src="'+c.uri+'/zibpay/assets/img/alipay-sys.png">                        <img class="lazyload pay-sys t-alipay" alt="wechat" src="" data-src="'+c.uri+'/zibpay/assets/img/wechat-sys.png">                    </div>                    <div class="row-5">                    <div class="pay-qrcon">                        <div class="qrcon">                            <div class="pay-logo-header mb10"><span class="pay-logo"></span><span class="pay-logo-name t-wechat">支付宝</span><span class="pay-logo-name t-alipay">微信支付</span></div>                            <div class="pay-title em09 muted-2-color padding-h6"></div>                            <div><span class="em09">￥</span><span class="pay-price em14"></span></div>                            <div class="pay-qrcode">                                <img src="" alt="pay-qrcode">                            </div>                        </div>                    <div class="pay-switch"></div>                    <div class="pay-notice"><div class="notice load">正在生成订单，请稍候</div></div>                    </div>\t\t\t\t</div>                </div>            </div>        </div>    </div>';a("link#zibpay_css").length||a("head").append('<link type="text/css" id="zibpay_css" rel="stylesheet" href="'+c.uri+"/zibpay/assets/css/main.css?ver="+c.ver+'">'),a("#"+h).length||p.append(e),a(document).ready(r),p.on("click",".initiate-pay",n),p.on("click",".pay-vip",l),p.on("hide.bs.modal","#"+h,function(){v.order_num=!1,y=!1}),u=a("#"+h)}function i(e,i){e.openid&&notyf("正在发起支付，请稍等...","load","","pay_ajax"),zib_ajax(i,e,function(i){if(!i.error){if(i.url&&i.open_url)return window.location.href=i.url,window.location.reload,void notyf("正在跳转到支付页面");if(i.jsapiParams){var n=i.jsapiParams;return"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",o(n),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",o(n)),document.attachEvent("onWeixinJSBridgeReady",o(n))):o(n),void notyf("请完成支付","","",e.openid?"pay_ajax":"")}i.url_qrcode&&(u.find(".more-html").remove(),a(".modal:not(#"+h+")").modal("hide"),u.find(".pay-qrcode img").attr("src",i.url_qrcode),d("请扫码支付，支付成功后会自动跳转",""),i.more_html&&u.find(".pay-notice").before('<div class="more-html">'+i.more_html+"</div>"),i.order_name&&u.find(".pay-title").html(i.order_name),i.order_price&&u.find(".pay-price").html(i.order_price),i.payment_method&&u.find(".pay-payment").removeClass("wechat alipay").addClass(i.payment_method),u.modal("show"),v=i,y||(t(),y=!0))}},"stop")}function t(){v.order_num&&a.ajax({type:"POST",url:f,data:{action:"check_pay",order_num:v.order_num},dataType:"json",success:function(a){"1"==a.status?(d("支付成功，页面跳转中","success"),setTimeout(function(){void 0!==m.return_url&&m.return_url?(window.location.href=delQueStr("openid",delQueStr("zippay",m.return_url)),window.location.reload):(location.href=delQueStr("openid",delQueStr("zippay")),location.reload)},300)):setTimeout(function(){t()},2e3)}})}function n(){var e=a(this),t=e.parents("form");return m=t.serializeObject(),m.action="initiate_pay",m.return_url||(m.return_url=window.location.href),i(m,e),!1}function d(a,e){var i=u.find(".pay-notice .notice");a="load"==e?'<i class="loading mr6"></i>'+a:a,i.removeClass("load warning success danger").addClass(e).html(a)}function o(a){WeixinJSBridge.invoke("getBrandWCPayRequest",a,function(a){a.err_msg,location.href=delQueStr("openid",delQueStr("zippay")),location.reload})}function r(){var e=GetRequest("zippay"),t=GetRequest("openid");e&&t&&s()&&(m.pay_type="wechat",m.openid=t,m.action="initiate_pay",i(m,a("<div></div>")))}function s(){var a=window.navigator.userAgent.toLowerCase();return"micromessenger"==a.match(/MicroMessenger/i)}function l(){var e=a(this),i='<div class="modal fade flex jc" id="modal_pay_uservip" tabindex="-1" role="dialog" aria-hidden="false">    <div class="modal-dialog" role="document">    <div class="modal-content">    <div class="modal-body"><h4 style="padding:20px;" class="text-center"><i class="loading zts em2x"></i></h4></div>    </div>    </div>    </div>    </div>';a("#modal_pay_uservip").length||p.append(i);var t=a("#modal_pay_uservip"),n=e.attr("vip-level")||1;return t.find(".payvip-modal").length?(a('a[href="#tab-payvip-'+n+'"]').tab("show"),t.modal("show")):(notyf("加载中，请稍等...","load","","payvip_ajax"),a.ajax({type:"POST",url:f,data:{action:"pay_vip",vip_level:n},dataType:"json",success:function(e){var i=e.msg||"请选择会员选项";-1!=i.indexOf("登录")&&(t.remove(),a(".signin-loader").click()),notyf(i,e.ys?e.ys:e.error?"danger":"",3,"payvip_ajax"),e.error||(t.find(".modal-content").html(e.html),t.find(".modal-content .tab-pane.active").length||t.find('.modal-content a[data-toggle="tab"]:eq(0)').click(),t.trigger("loaded.bs.modal").modal("show"),auto_fun())}})),!1}var c=window._win,p=a("body"),u=!1,y=!1,v={},m={},f=c.ajax_url,h="zibpay_modal";e(),p.on("controller.change",'[data-controller="payment_method"][data-value="card_pass"]',function(e,i){var t=a(this),n=t.parents("form");i?n.find(".charge-box").hide():n.find(".charge-box").show()})})(jQuery);